# 7주차-따릉이 대여량 예측

### 데이터셋 업로드

```jsx
import pandas as pd
import numpy as np

train_X = pd.read_csv('/content/train.csv')
test_X = pd.read_csv('/content/test.csv')
```

```jsx
train_X.info()
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled.png)

- 컬럼별 데이터 타입 확인할 때 사용

```jsx
test_X.info()
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%201.png)

### train_X 데이터셋 결측치 확인 및 처리

```jsx
train_X.isnull().sum()
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%202.png)

```jsx
train_null = train_X[['hour_bef_temperature','hour_bef_precipitation', 'hour_bef_windspeed', 'hour_bef_humidity','hour_bef_visibility', 'hour_bef_ozone', 'hour_bef_pm10', 'hour_bef_pm2.5']]
train_mean = train_null.mean()
train_mean
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%203.png)

- 결측치가 존재하는 컬럼을 하나의 변수에 담아 평균값 산출

```jsx
train_X['hour_bef_temperature'] = train_X['hour_bef_temperature'].fillna(train_mean['hour_bef_temperature'])
train_X['hour_bef_precipitation'] = train_X['hour_bef_precipitation'].fillna(train_mean['hour_bef_precipitation'])
train_X['hour_bef_windspeed'] = train_X['hour_bef_windspeed'].fillna(train_mean['hour_bef_windspeed'])
train_X['hour_bef_humidity'] = train_X['hour_bef_humidity'].fillna(train_mean['hour_bef_humidity'])
train_X['hour_bef_visibility'] = train_X['hour_bef_visibility'].fillna(train_mean['hour_bef_visibility'])
train_X['hour_bef_ozone'] = train_X['hour_bef_ozone'].fillna(train_mean['hour_bef_ozone'])
train_X['hour_bef_pm10'] = train_X['hour_bef_pm10'].fillna(train_mean['hour_bef_pm10'])
train_X['hour_bef_pm2.5'] = train_X['hour_bef_pm2.5'].fillna(train_mean['hour_bef_pm2.5'])
train_X.isnull().sum()
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%204.png)

- 결측치에 대해 컬럼별 평균값으로 대체 → 결측치 확인한 결과 처리가 잘된 것을 확인할 수 있음

### test_X 데이터셋에 대해서도 똑같은 방법으로 결측치 대체

```jsx
test_X.isnull().sum()
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%205.png)

```jsx
test_null = test_X[['hour_bef_temperature','hour_bef_precipitation', 'hour_bef_windspeed', 'hour_bef_humidity','hour_bef_visibility', 'hour_bef_ozone', 'hour_bef_pm10', 'hour_bef_pm2.5']]
test_mean = test_null.mean()

test_X['hour_bef_temperature'] = test_X['hour_bef_temperature'].fillna(test_mean['hour_bef_temperature'])
test_X['hour_bef_precipitation'] = test_X['hour_bef_precipitation'].fillna(test_mean['hour_bef_precipitation'])
test_X['hour_bef_windspeed'] = test_X['hour_bef_windspeed'].fillna(test_mean['hour_bef_windspeed'])
test_X['hour_bef_humidity'] = test_X['hour_bef_humidity'].fillna(test_mean['hour_bef_humidity'])
test_X['hour_bef_visibility'] = test_X['hour_bef_visibility'].fillna(test_mean['hour_bef_visibility'])
test_X['hour_bef_ozone'] = test_X['hour_bef_ozone'].fillna(test_mean['hour_bef_ozone'])
test_X['hour_bef_pm10'] = test_X['hour_bef_pm10'].fillna(test_mean['hour_bef_pm10'])
test_X['hour_bef_pm2.5'] = test_X['hour_bef_pm2.5'].fillna(test_mean['hour_bef_pm2.5'])
test_X.isnull().sum()
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%206.png)

### 목표 target인 count변수를 따로 담고, train 데이터셋에서 컬럼 삭제

```jsx
train_Y = train_X['count']
train_X = train_X.drop(columns='count')
train_X.head(3)
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%207.png)

- 예측해야하는 target은 count 변수임
- train과 test 데이터 셋을 분할하기 위해서는 count변수를 target 변수로 따로 빼줘야함

### id변수는 목표 target인 count 변수에 크게 영향을 미치지 않음 → 컬럼 삭제

```jsx
train_X.drop('id', axis=1)
test_X.drop('id', axis=1)
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%208.png)

### 목표 target의 데이터 타입에 따른 예측 모델 정의

```jsx
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor

x_train, x_val, y_train, y_val = train_test_split(train_X, train_Y, test_size=0.3, random_state=77)

print(x_train.shape, y_train.shape)
print(x_val.shape, y_val.shape)
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%209.png)

```jsx
model = RandomForestRegressor()
model.fit(x_train, y_train)
print(model.score(x_train, y_train))
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%2010.png)

```jsx
print(model.score(x_val, y_val))
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%2011.png)

- 목표 변수 = count는 수치형 변수 → 스케일링 필요 X
- 목표 변수 = count(수치형) → RandomForestRegressor 모델 적용
- 앙상블에서 랜덤포레스트 회귀이기 때문에 모델 fit의 매개변수는 독립변수 & 종속변수 2가지
- 모델.score : 모델의 예측 점수를 나타냄
- train 데이터 셋 : 0.96 / 검증 데이터 셋 : 0.77 → 대체로 좋은 스코어가 나옴을 알 수 있음

### test셋으로 예측 수행

```jsx
pred = model.predict(test_X)
print(pred)
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%2012.png)

```jsx
result = pd.DataFrame({'id' : test_X['id'], 'count' : pred})
result
```

![Untitled](7%E1%84%8C%E1%85%AE%E1%84%8E%E1%85%A1-%E1%84%84%E1%85%A1%E1%84%85%E1%85%B3%E1%86%BC%E1%84%8B%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8B%E1%85%A7%E1%84%85%E1%85%A3%E1%86%BC%20%E1%84%8B%E1%85%A8%E1%84%8E%E1%85%B3%E1%86%A8%20d41ea89a652d42ddb2f139cc2c482352/Untitled%2013.png)

- test셋에 존재하는 따릉이 식별번호인 id별 대여량 예측 결과를 pd.DataFrame을 통해 데이터 프레임으로 통합